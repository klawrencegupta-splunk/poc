# For questions or issues email:  Tony.Lee -at- FireEye.com

#WARNING:  Use TCP, but if UDP is necessary -- set FireEye UDP syslog to max size of 4096:
#ssh admin@<FireEyeBox>
#en
#conf t
#fenotify rsyslog trap-sink <Splunk_connector> chunk-size 4096


#Stanzas in this file
# - syslog - Should probably not be used unless desparate
# - fe_json_syslog
# - fe_xml_syslog - JSON is preferred
# - hx_cef_syslog
# - fe_cef_syslog
# - fe_csv_syslog
# - fe_xml - JSON is preferred
# - fe_json
# - fe_tap_json


###### Can convert syslog to other sourcetypes, but sourcetype should be specified elsewhere ######
#[syslog]
# The next three lines are used to linemerge XML and JSON for testing.  They should not be used in production.  Enabling them will negatively affect other syslog data.
#TRUNCATE=0
#SHOULD_LINEMERGE = true
#LINE_BREAKER = ((?!))

# The next two line use transforms.conf to send the syslog events and rename them to something other than syslog.  fe_xml_syslog and fe_xml_json should be sent directly as those sourcetypes.
#TRANSFORMS-updateFireEyeSourcetypes = fix_FireEye_CEF_st, fix_FireEye_CSV_st, fix_FireEye_XML_st, fix_FireEye_JSON_st
#TRANSFORMS-updateFireEyeHXSourcetypes = fix_HX_CEF_st, fix_HX2_CEF_st

# Uncomment the next line to send FireEye data to a separate index called "fireeye"
#TRANSFORMS-updateFireEyeIndex = fix_FireEye_CEF_in, fix_FireEye_CSV_in, fix_FireEye_XML_in, fix_FireEye_JSON_st, fix_HX_CEF_in, fix_HX2_CEF_in



###### FireEye JSON over SYSLOG ###### - RECOMMENDED INSTEAD OF XML
[fe_json_syslog]
SHOULD_LINEMERGE = false
KV_MODE=json
TRUNCATE = 0
#SEDCMD-carriage_return = s/[\n\r]/ /g
SEDCMD-remove_nulls = s/\\x00//g
LINE_BREAKER = (?:<\d+>fenotify-\d+.*?:)

# Strip the SYSLOG header off to make it JSON
TRANSFORMS-stripSyslog = FEYE-syslog-header-strip

FIELDALIAS-category_for_fireeye = alert.name as category
FIELDALIAS-id_for_fireeye = alert.id as id
FIELDALIAS-signature_for_fireeye = alert.explanation.malware-detected.malware.name as signature
FIELDALIAS-sig_name_for_fireeye = alert.explanation.ips-detected.sig-name as sig_name
FIELDALIAS-severity_for_fireeye = alert.severity as severity
FIELDALIAS-occurred_for_fireeye = alert.occurred as occurred
FIELDALIAS-transport_for_fireeye = alert.explanation.protocol as transport
FIELDALIAS-src_ip_for_fireeye_app = alert.src.ip as src_ip
FIELDALIAS-src_for_fireeye = alert.src.ip as src
FIELDALIAS-src_port_for_fireeye = alert.src.port as src_port
FIELDALIAS-src_mac_for_fireeye = alert.src.mac as src_mac
FIELDALIAS-dest_ip_for_fireeye_app = alert.dst.ip as dest_ip
FIELDALIAS-dest_for_fireeye = alert.dst.ip as dest
FIELDALIAS-dest_port_for_fireeye = alert.dst.port as dest_port
FIELDALIAS-dest_mac_for_fireeye = alert.dst.mac as dest_mac
FIELDALIAS-file_hash_for_fireeye = alert.explanation.malware-detected.malware.md5sum as file_hash

FIELDALIAS-dvc_ip_cm_for_fireeye = alert.sensor-ip as dvc_ip
FIELDALIAS-dvc_host_cm_for_fireeye = alert.sensor as dvc_host
FIELDALIAS-dvc_ip_for_fireeye = host as dvc_ip
FIELDALIAS-dvc_host_for_fireeye = appliance as dvc_host
#EVAL-dvc_host = coalesce(appliance, alert.sensor)

FIELDALIAS-app_for_fireeye = alert.explanation.malware-detected.malware.application as app
FIELDALIAS-action_for_fireeye = alert.action as action
FIELDALIAS-infURL_for_fireeye = alert.explanation.cnc-services.cnc-service.address as infURL
FIELDALIAS-objURL_for_fireeye = alert.explanation.malware-detected.malware{}.objurl as objURL
#This next product extraction line overrides the CM entry if it exists
FIELDALIAS-product_for_fireeye = alert.product as product
FIELDALIAS-product_version_for_fireeye = version as product_version
FIELDALIAS-ext_ref_for_fireeye = alert.alert-url as ext_ref
#product = product

#EX Fields
FIELDALIAS-duser_for_fireeye = alert.dst.smtp-to AS duser
FIELDALIAS-suser_for_fireeye = alert.src.smtp-mail-from AS suser
FIELDALIAS-duser_array_for_fireeye = alert{}.dst.smtp-to AS duser
FIELDALIAS-suser_array_for_fireeye = alert{}.src.smtp-mail-from AS suser
FIELDALIAS-malware_url_for_fireeye = alert.src.url as malware_url
FIELDALIAS-id_array_for_fireeye = alert{}.id as id
FIELDALIAS-signature_array_for_fireeye = alert{}.explanation.malware-detected.malware.name as signature
FIELDALIAS-severity_array_for_fireeye = alert{}.severity as severity
FIELDALIAS-occurred_array_for_fireeye = alert{}.occurred as occurred
FIELDALIAS-file_hash_array_for_fireeye = alert{}.explanation.malware-detected.malware.md5sum as file_hash
FIELDALIAS-email_file_name_for_fireeye = alert{}.explanation.malware-detected.malware.original as file_name
FIELDALIAS-recipient_for_fireeye = duser as recipient
FIELDALIAS-src_usr_for_fireeye = suser as src_user
FIELDALIAS-email_subject_for_fireeye =  alert.smtp-message.subject as subject
FIELDALIAS-email_id_for_fireeye =  id as message_id

#Client request
EXTRACT-header_dest_for_fireeye = "http-header": "\S+ [^:]+://(?<http_header_dest>[^/]+)/
EXTRACT-channel_dest_for_fireeye = "channel": "\S+ [^:]+://(?<channel_dest>[^/]+)/
EXTRACT-objurl_dest_for_fireeye = "objurl": "((\S+)? [^:]+://)?(?<url_dest>[^/]+)
FIELDALIAS-dnd_address = alert.explanation.cnc-services.cnc-service.address AS cnc_address
FIELDALIAS-cnc_msg = alert.explanation.cnc-services.cnc-service.channel AS cnc_msg
FIELDALIAS-fe_url = alert.explanation.malware-detected.malware{}.objurl AS url



###### FireEye XML over SYSLOG ###### - WE RECOMMEND JSON DUE TO LOWER BROWSER MEMORY USAGE
[fe_xml_syslog]
SHOULD_LINEMERGE = false
KV_MODE=xml
TRUNCATE=0
SEDCMD-carriage_return = s/[\n\r]/ /g
LINE_BREAKER = (?:<\d+>fenotify-\d+.*?:)(\s\<?xml)

# THIS SECTION STRIPS THE SYSLOG HEADER AND MAKES AUTO PARSING XML - HOWEVER IT CAN KILL BROWSER MEMORY DUE TO THE SIZE OF THE FIREEYE EVENTS

#Strip the syslog header and make it recognized as XML
#TRANSFORMS-stripSyslog = FEYE-syslog-header-strip-xml

#EXTRACT-malware-info = \s*<malware\sname=\"(?<malware_name>[\w-]{1,30})\"\s*(sid=\"(?<malware_sid>\d*)")?\s*(stype=\"(?<malware_stype>[\w-]{1,30})\")? in _raw

#FIELDALIAS-category_for_fireeye = alerts.alert{@name} as category
#FIELDALIAS-id_for_fireeye = alerts.alert{@id} as id
#FIELDALIAS-signature_for_fireeye = malware_name as signature
#FIELDALIAS-sig_name_for_fireeye = alerts.alert.explanation.ips-detected.ips-event.sig-name as sig_name
#FIELDALIAS-severity_for_fireeye = alerts.alert{@severity} as severity
#FIELDALIAS-occurred_for_fireeye = alerts.alert.occurred as occurred
#FIELDALIAS-transport_for_fireeye = alerts.alert.explanation{@protocol} as transport
#FIELDALIAS-src_ip_for_fireeye_app = alerts.alert.src.ip as src_ip
#FIELDALIAS-src_for_fireeye = alerts.alert.src.ip as src
#FIELDALIAS-src_port_for_fireeye = alerts.alert.src.port as src_port
#FIELDALIAS-src_mac_for_fireeye = alerts.alert.src.mac as src_mac
#FIELDALIAS-dest_ip_for_fireeye_app = alerts.alert.dst.ip as dest_ip
#FIELDALIAS-dest_for_fireeye = alerts.alert.dst.ip as dest
#FIELDALIAS-dest_port_for_fireeye = alerts.alert.dst.port as dest_port
#FIELDALIAS-dest_mac_for_fireeye = alerts.alert.dst.mac as dest_mac
#FIELDALIAS-file_hash_for_fireeye = alerts.alert.explanation.malware-detected.malware.md5sum as file_hash
#FIELDALIAS-app_for_fireeye = alerts.alert.explanation.malware-detected.malware.application as app
#FIELDALIAS-action_for_fireeye = alerts.alert.action as action
#FIELDALIAS-infURL_for_fireeye = alerts.alert.explanation.cnc-services.cnc-service.address as infURL
#FIELDALIAS-objURL_for_fireeye = alerts.alert.explanation.malware-detected.malware.objurl as objURL
#EXTRACT-alert_appliance_cm_sensor_for_fireeye = <alert\sappliance.*?\sproduct="(?<product>.*?)".*?\ssensor="(?<dvc_host>.*?)"
#EXTRACT-alert_appliance_lms_sensor_for_fireeye = <alerts\sappliance="(?<dvc_host>.*?)".*?product="(?<product>.*?)"

#FIELDALIAS-product_version_for_fireeye = alerts{@version} as product_version
#FIELDALIAS-ext_ref_for_fireeye = alerts.alert.alert-url as ext_ref
#FIELDALIAS-file_type_for_fireeye = alerts.alert.explanation.malware-detected.malware{@type} as file_type
#FIELDALIAS-executed_time_for_fireeye = alerts.alert.explanation.malware-detected.malware.executed-at as executed_time

#EX Field Alias
#FIELDALIAS-duser_for_fireeye = alerts.alert.dst.smtp-to as duser
#FIELDALIAS-suser_for_fireeye = alerts.alert.src.smtp-mail-from as suser
#FIELDALIAS-domain_for_fireeye = alerts.alert.src.domain as domain
#FIELDALIAS-malware_url_for_fireeye = alerts.alert.src.url as malware_url
#FIELDALIAS-signature_for_fireeye = alerts.alert.explanation.malware-detected.malware{@name} as signature
#FIELDALIAS-email_file_name_for_fireeye = alerts.alert.explanation.malware-detected.malware.original as file_name
#FIELDALIAS-recipient_for_fireeye = alerts.alert.dst.smtp-to as recipient
#FIELDALIAS-src_usr_for_fireeye = alerts.alert.src.smtp-mail-from as src_user
#FIELDALIAS-email_subject_for_fireeye =  alerts.alert.smtp-message.subject as subject
#FIELDALIAS-email_id_for_fireeye = id as message_id

#dvc_ip = dvc_ip



# Manual Extractions are less resource intensive
EXTRACT-source_vlan_ip_for_fireeye = <src\svlan="(?<vlan_num>[\d]*)">.*<ip>(?<src_ip>.*)</ip>.*</src>
EXTRACT-alert_appliance_cm_sensor_for_fireeye = <alert\sappliance.*?\sproduct="(?<product>.*?)".*?\ssensor="(?<dvc_host>.*?)"
EXTRACT-alert_appliance_lms_sensor_for_fireeye = <alerts\sappliance="(?<dvc_host>.*?)".*?product="(?<product>.*?)"
EXTRACT-source_severity_for_fireeye = severity="(?<severity>.*?)"
EXTRACT-source_protocol_for_fireeye = protocol="(?<protocol>.*?)"
EXTRACT-source_id_category_for_fireeye = \sid="(?<id>\d+)"\sname="(?<category>.*?)"
EXTRACT-source_host_for_fireeye = <src\svlan="[\d]*">.*<host>(?<src_host>.*)</host>.*</src>
EXTRACT-source_mac_for_fireeye = <src\svlan="[\d]*">.*<mac>(?<src_mac>.*)</mac>.*</src>
EXTRACT-source_port_for_fireeye = <src\svlan="[\d]*">.*<port>(?<src_port>.*)</port>.*</src>
EXTRACT-destination_ip_for_fireeye = <dst>.*<ip>(?<dest_ip>.*)</ip>.*</dst>
EXTRACT-destination_mac_for_fireeye = <dst>.*<mac>(?<dest_mac>.*)</mac>.*</dst>
EXTRACT-destination_port_for_fireeye = <dst>.*<port>(?<dest_port>.*)</port>.*</dst>
EXTRACT-malware-info_for_fireeye = <malware\sname=\"(?<malware_name>[\w-\.]{1,30})\"\s*(sid=\"(?<malware_sid>\d*)")?\s*(stype=\"(?<malware_stype>[\w-]{1,30})\")?
EXTRACT-occurred_for_fireeye = <occurred>(?<occurred>.{1,25})</occurred>
EXTRACT-file_hash_for_fireeye = <md5sum>(?<file_hash>.{32})</md5sum>
EXTRACT-app_for_fireeye = <application>(?<app>.{1,40})</application>
EXTRACT-action_for_fireeye = <action>(?<action>.{1,10})</action>
EXTRACT-infURL_for_fireeye = <cnc-services>.{1,50}<address>[\r\n]*\s*(?<infURL>.{1,40})[\r\n]*\s*</address>
EXTRACT-objURL_for_fireeye = <objurl>(?<objURL>.*?)</objurl>
EXTRACT-sig_name_for_fireeye = <sig-name>(?<sig_name>.*)</sig-name>
EXTRACT-product_version_for_fireeye = <alerts.*version="(?<product_version>[\d\.]+)"
EXTRACT-ext_ref_version_for_fireeye = <alert-url>(?<ext_ref>.{1,100})</alert-url>
EXTRACT-file_type_for_fireeye = <malware\s.*?\stype="(?<type>.*?)"
FIELDALIAS-file_type_for_fireeye = type AS file_type

#EX Fields
EXTRACT-mail_suser_duser_for_fireeye = <src>.*<domain>(?<domain>.*)</domain>.*<smtp-mail-from>(?<suser>.*)</smtp-mail-from>.*<url>(?<url>.*)</url>.*</src>.*<dst>.*<smtp-to>(?<duser>.*)</smtp-to>
EXTRACT-subject_for_fireeye = <subject>(?<subject>.*)</subject>
EXTRACT-signature_for_fireeye = <malware\smalicious.*?\sname="(?<malware_name>.*?)"
FIELDALIAS-malware_url_for_fireeye = url AS malware_url
FIELDALIAS-category_for_fireeye = name as category
FIELDALIAS-signature_for_fireeye = malware_name as signature
FIELDALIAS-transport_for_fireeye = protocol as transport
FIELDALIAS-src_for_fireeye = src_ip as src
FIELDALIAS-dest_for_fireeye = dest_ip as dest
FIELDALIAS-dvc_host_for_fireeye = appliance as dvc_host
FIELDALIAS-recipient_for_fireeye = duser as recipient
FIELDALIAS-src_usr_for_fireeye = suser as src_user

#product=product
#dvc_ip = dvc_ip
#id=id
#severity=severity




###### HX CEF over SYSLOG ######
[hx_cef_syslog]
#TRUNCATE=0
#SHOULD_LINEMERGE = false
#LINE_BREAKER = ((?!))

#TIME_PREFIX = \s(end|rt)\=
#TIME_FORMAT = %10S%3n
#MAX_TIMESTAMP_LOOKAHEAD = 350
#NO_BINARY_CHECK = 1
SHOULD_LINEMERGE = false
pulldown_type = 1
REPORT-cefevents = cefKeys
KV_MODE = none

EXTRACT-occurred_for_fireeye = (\|rt=(?P<occurred>.+?)\s+\w+=)
EXTRACT-FileName=/FileName:"(?P<file_name>\w+\.\w+)(?=")
EXTRACT-RegistryPath=/Path:(?P<registry_path>\w+\\\\\w+\\\\\w+)(?=)
EXTRACT-Md5Sum=/Md5sum:"(?P<md5>[^"]+)
EXTRACT-strings=/string:\"(?P<function_string>[^\"]+)"

FIELDALIAS-domain_for_fireeye_app = dntdom as domain
FIELDALIAS-id_for_fireeye = externalId as id
FIELDALIAS-src_host_for_fireeye_app = dhost as src_host
FIELDALIAS-src_ip_for_fireeye_app = dst as src_ip
FIELDALIAS-src_for_fireeye = dst as src
FIELDALIAS-src_mac_for_fireeye = dmac as src_mac
FIELDALIAS-ioc_name_for_fireeye = cs4 as ioc_name
FIELDALIAS-dvc_host_for_fireeye = dvchost as dvc_host
FIELDALIAS-sweep_name=cs3 AS sweep_name

# Parse CEF header
REPORT-fireeye_cef_parse = fireeye_cef

# Convert product name standard name (MPS = Web MPS)
LOOKUP-product_for_fireeye = fireeye_product_lookup cef_dproduct OUTPUT product

# Convert severity numbers into words (1 = minr)
LOOKUP-hx_severity_for_fireeye = hx_fireeye_severity_lookup cef_severity OUTPUT severity

FIELDALIAS-category_for_fireeye = cef_name as category
FIELDALIAS-vendor_for_fireeye = cef_dvendor as vendor
FIELDALIAS-product_version_for_fireeye = cef_dversion as product_version
FIELDALIAS-agentId_for_fireeye = cs1 as agentId
FIELDALIAS-agentVersion_for_fireeye = cs2 as agentVersion
FIELDALIAS-ext_ref_for_fireeye = request as ext_ref





###### FireEye CEF over SYSLOG ######
[fe_cef_syslog]
SHOULD_LINEMERGE = false
LINE_BREAKER = ((?!))
#TIME_PREFIX = .+\|rt=
#TIME_FORMAT = %b %d %Y %H:%M:%S %Z
#MAX_TIMESTAMP_LOOKAHEAD = 24
#MAX_TIMESTAMP_LOOKAHEAD = 350
#TRUNCATE=0
REPORT-cefevents = cefKeys
KV_MODE = none

# Needed extracting - rt as occurred
#EXTRACT-occurred_for_fireeye = (\|rt=(?P<occurred>.+?)\s+\w+=)
#EXTRACT-occurred_for_fireeye = rt=(?<occurred>\w+\s\d+\s\d+\s\d+\:\d+\:\d+\s\w+\s)


# Parse CEF header
REPORT-fireeye_cef_parse = fireeye_cef

# Convert severity numbers into words (1 = minr)
LOOKUP-severity_for_fireeye = fireeye_severity_lookup cef_severity OUTPUT severity

# Convert product name standard name (MPS = Web MPS)
LOOKUP-product_for_fireeye = fireeye_product_lookup cef_dproduct OUTPUT product

FIELDALIAS-occurred_for_fireeye = rt as occurred
FIELDALIAS-category_for_fireeye = cef_name as category
FIELDALIAS-id_for_fireeye = externalId as id
FIELDALIAS-signature_for_fireeye = cs1 as signature
FIELDALIAS-sig_name_for_fireeye = msg as sig_name
FIELDALIAS-transport_for_fireeye = proto as transport
FIELDALIAS-src_ip_for_fireeye_app = src as src_ip
FIELDALIAS-src_port_for_fireeye = spt as src_port
FIELDALIAS-src_mac_for_fireeye = smac as src_mac
FIELDALIAS-dest_ip_for_fireeye_app = dst as dest_ip
FIELDALIAS-dest_for_fireeye = dst as dest
FIELDALIAS-dest_port_for_fireeye = cn3 as dest_port
FIELDALIAS-dest_mac_for_fireeye = dmac as dest_mac
FIELDALIAS-file_hash_for_fireeye = fileHash as file_hash
FIELDALIAS-dvc_ip_for_fireeye = dvc as dvc_ip
FIELDALIAS-dvc_host_for_fireeye = dvchost as dvc_host
# line below corrects Splunk error in parsing host field
FIELDALIAS-host_for_fireeye = dvc as host
FIELDALIAS-vendor_for_fireeye = cef_dvendor as vendor
FIELDALIAS-product_version_for_fireeye = cef_dversion as product_version
FIELDALIAS-infURL_for_fireeye = cs5 as infURL
FIELDALIAS-objURL_for_fireeye = filePath as objURL
FIELDALIAS-ext_ref_for_fireeye = cs4 as ext_ref
#FIELDALIAS-cncHost_for_fireeye = cn5 as cncHost
#FIELDALIAS-cncPort_for_fireeye = cn3 as cncPort

#EX Fields
FIELDALIAS-malware_url_for_fireeye = request AS malware_url


###### FireEye CSV over SYSLOG ######
## protocol is not passed
[fe_csv_syslog]
TRUNCATE=0

#Extract vendor
EXTRACT-vendor_for_fireeye = .*fenotify.*alert\:\sCSV\:\d\:(?<vendor>[\w]{7})\:

#SEDCMD-remove_nulls = s/\\x00//g
LINE_BREAKER = ((?:[\r\n](?:\\x00)?)+)
FIELDALIAS-category_for_fireeye = alertType as category
FIELDALIAS-id_for_fireeye = alertid as id
FIELDALIAS-signature_for_fireeye = sname as signature
FIELDALIAS-sig_name_for_fireeye = signame as sig_name
FIELDALIAS-severity_for_fireeye = sev as severity
FIELDALIAS-transport_for_fireeye = proto as transport
FIELDALIAS-src_ip_for_fireeye_app = src as src_ip
FIELDALIAS-src_port_for_fireeye = spt as src_port
FIELDALIAS-src_mac_for_fireeye = smac as src_mac
FIELDALIAS-dest_ip_for_fireeye_app = dst as dest_ip
FIELDALIAS-dest_for_fireeye = dst as dest
FIELDALIAS-dest_port_for_fireeye = dpt as dest_port
FIELDALIAS-dest_mac_for_fireeye = dmac as dest_mac
FIELDALIAS-file_hash_for_fireeye = fileHash as file_hash
FIELDALIAS-dvc_ip_for_fireeye = dvc as dvc_ip
FIELDALIAS-dvc_host_for_fireeye = dvchost as dvc_host
FIELDALIAS-app_for_fireeye = application as app
FIELDALIAS-infURL_for_fireeye = cnchost as infURL
FIELDALIAS-objURL_for_fireeye = objurl as objURL
FIELDALIAS-product_version_for_fireeye = release as product_version
FIELDALIAS-ext_ref_for_fireeye = link as ext_ref
#action = action
#product = product

#EX Fields
FIELDALIAS-suser_for_fireeye = smtp_mail_from AS suser
FIELDALIAS-duser_for_fireeye = smtp_to AS duser
FIELDALIAS-malware_url_for_fireeye = mwurl AS malware_url
FIELDALIAS-recipient_for_fireeye = smtp-to as recipient
FIELDALIAS-src_usr_for_fireeye = smtp-mail-from as src_user




###### FireEye XML over HTTPS ######
[fe_xml]
TRUNCATE=0
SHOULD_LINEMERGE = false
LINE_BREAKER = ((?!))
KV_MODE = XML

EXTRACT-malware-info = \s*<malware\sname=\"(?<malware_name>[\w-]{1,30})\"\s*(sid=\"(?<malware_sid>\d*)")?\s*(stype=\"(?<malware_stype>[\w-]{1,30})\")? in _raw

FIELDALIAS-category_for_fireeye = alerts.alert{@name} as category
FIELDALIAS-id_for_fireeye = alerts.alert{@id} as id
FIELDALIAS-signature_for_fireeye = malware_name as signature
FIELDALIAS-sig_name_for_fireeye = alerts.alert.explanation.ips-detected.ips-event.sig-name as sig_name
FIELDALIAS-severity_for_fireeye = alerts.alert{@severity} as severity
FIELDALIAS-occurred_for_fireeye = alerts.alert.occurred as occurred
FIELDALIAS-transport_for_fireeye = alerts.alert.explanation{@protocol} as transport
FIELDALIAS-src_ip_for_fireeye_app = alerts.alert.src.ip as src_ip
FIELDALIAS-src_for_fireeye = alerts.alert.src.ip as src
FIELDALIAS-src_port_for_fireeye = alerts.alert.src.port as src_port
FIELDALIAS-src_mac_for_fireeye = alerts.alert.src.mac as src_mac
FIELDALIAS-dest_ip_for_fireeye_app = alerts.alert.dst.ip as dest_ip
FIELDALIAS-dest_for_fireeye = alerts.alert.dst.ip as dest
FIELDALIAS-dest_port_for_fireeye = alerts.alert.dst.port as dest_port
FIELDALIAS-dest_mac_for_fireeye = alerts.alert.dst.mac as dest_mac
FIELDALIAS-file_hash_for_fireeye = alerts.alert.explanation.malware-detected.malware.md5sum as file_hash
FIELDALIAS-dvc_host_for_fireeye = alerts{@appliance} as dvc_host
FIELDALIAS-app_for_fireeye = alerts.alert.explanation.malware-detected.malware.application as app
FIELDALIAS-action_for_fireeye = alerts.alert.action as action
FIELDALIAS-infURL_for_fireeye = alerts.alert.explanation.cnc-services.cnc-service.address as infURL
FIELDALIAS-objURL_for_fireeye = alerts.alert.explanation.malware-detected.malware.objurl as objURL
FIELDALIAS-product_for_fireeye = alerts{@product} as product
FIELDALIAS-product_version_for_fireeye = alerts{@version} as product_version
FIELDALIAS-ext_ref_for_fireeye = alerts.alert.alert-url as ext_ref
FIELDALIAS-file_type_for_fireeye = alerts.alert.explanation.malware-detected.malware{@type} as file_type
FIELDALIAS-executed_time_for_fireeye = alerts.alert.explanation.malware-detected.malware.executed-at as executed_time

#EX Field Alias
FIELDALIAS-duser_for_fireeye = alerts.alert.dst.smtp-to as duser
FIELDALIAS-suser_for_fireeye = alerts.alert.src.smtp-mail-from as suser
FIELDALIAS-domain_for_fireeye = alerts.alert.src.domain as domain
FIELDALIAS-malware_url_for_fireeye = alerts.alert.src.url as malware_url
FIELDALIAS-signature_for_fireeye = alerts.alert.explanation.malware-detected.malware{@name} as signature
FIELDALIAS-email_file_name_for_fireeye = alerts.alert.explanation.malware-detected.malware.original as file_name
FIELDALIAS-recipient_for_fireeye = alerts.alert.dst.smtp-to as recipient
FIELDALIAS-src_usr_for_fireeye = alerts.alert.src.smtp-mail-from as src_user
FIELDALIAS-email_subject_for_fireeye =  alerts.alert.smtp-message.subject as subject
FIELDALIAS-email_id_for_fireeye = id as message_id

#dvc_ip = dvc_ip



###### FireEye JSON over HTTPS ######
[fe_json]
TRUNCATE=0
SHOULD_LINEMERGE = false
LINE_BREAKER = ((?!))
KV_MODE = JSON
TIME_PREFIX = \"occurred\"\:\s
TIME_FORMAT = \"%Y-%m-%d %H:%M:%S+00\"
TZ = UTC
#EXTRACT-malware-info_for_fireeye = "malware":\s\[?[\r\n]?\s*\{.*"name":\s"(?<malware_name>[\w\d\-\.]{1,40})",
#FIELDALIAS-signature_for_fireeye = malware_name as signature
FIELDALIAS-category_for_fireeye = alert.name as category
FIELDALIAS-id_for_fireeye = alert.id as id
FIELDALIAS-signature_for_fireeye = alert.explanation.malware-detected.malware.name as signature
FIELDALIAS-sig_name_for_fireeye = alert.explanation.ips-detected.sig-name as sig_name
FIELDALIAS-severity_for_fireeye = alert.severity as severity
FIELDALIAS-occurred_for_fireeye = alert.occurred as occurred
FIELDALIAS-transport_for_fireeye = alert.explanation.protocol as transport
FIELDALIAS-src_ip_for_fireeye_app = alert.src.ip as src_ip
FIELDALIAS-src_for_fireeye = alert.src.ip as src
FIELDALIAS-src_port_for_fireeye = alert.src.port as src_port
FIELDALIAS-src_mac_for_fireeye = alert.src.mac as src_mac
FIELDALIAS-dest_ip_for_fireeye_app = alert.dst.ip as dest_ip
FIELDALIAS-dest_for_fireeye = alert.dst.ip as dest
FIELDALIAS-dest_port_for_fireeye = alert.dst.port as dest_port
FIELDALIAS-dest_mac_for_fireeye = alert.dst.mac as dest_mac
FIELDALIAS-file_hash_for_fireeye = alert.explanation.malware-detected.malware.md5sum as file_hash
FIELDALIAS-dvc_ip_for_fireeye = host as dvc_ip
FIELDALIAS-dvc_host_for_fireeye = appliance as dvc_host
FIELDALIAS-app_for_fireeye = alert.explanation.malware-detected.malware.application as app
FIELDALIAS-action_for_fireeye = alert.action as action
FIELDALIAS-infURL_for_fireeye = alert.explanation.cnc-services.cnc-service.address as infURL
FIELDALIAS-objURL_for_fireeye = alert.explanation.malware-detected.malware{}.objurl as objURL
FIELDALIAS-product_version_for_fireeye = version as product_version
FIELDALIAS-ext_ref_for_fireeye = alert.alert-url as ext_ref
#product = product

#EX Fields
FIELDALIAS-duser_for_fireeye = alert.dst.smtp-to AS duser
FIELDALIAS-suser_for_fireeye = alert.src.smtp-mail-from AS suser
FIELDALIAS-duser_array_for_fireeye = alert{}.dst.smtp-to AS duser
FIELDALIAS-suser_array_for_fireeye = alert{}.src.smtp-mail-from AS suser
FIELDALIAS-malware_url_for_fireeye = alert.src.url as malware_url
FIELDALIAS-id_array_for_fireeye = alert{}.id as id
FIELDALIAS-signature_array_for_fireeye = alert{}.explanation.malware-detected.malware.name as signature
FIELDALIAS-severity_array_for_fireeye = alert{}.severity as severity
FIELDALIAS-occurred_array_for_fireeye = alert{}.occurred as occurred
FIELDALIAS-file_hash_array_for_fireeye = alert{}.explanation.malware-detected.malware.md5sum as file_hash
FIELDALIAS-email_file_name_for_fireeye = alert.explanation.malware-detected.malware.original as file_name
FIELDALIAS-recipient_for_fireeye = alert.dst.smtp-to as recipient
FIELDALIAS-src_usr_for_fireeye = alert.src.smtp-mail-from as src_user
FIELDALIAS-email_subject_for_fireeye =  alert.smtp-message.subject as subject
FIELDALIAS-email_id_for_fireeye =  id as message_id


#CM Fields
FIELDALIAS-file_hash_array_cm_for_fireeye = alert.explanation.malware-detected.malware{}.md5sum as file_hash
FIELDALIAS-cm_signature_array_for_fireeye = alert.explanation.malware-detected.malware{}.name as signature


###### FireEye Email Threat Prevention (Cloud) ######
[fe_etp]
REPORT-cefevents = cefKeys
KV_MODE = none
# Parse CEF header
REPORT-fireeye_cef_parse = fireeye_cef
# Convert severity numbers into words (1 = minr)
LOOKUP-severity_for_fireeye = fireeye_severity_lookup cef_severity OUTPUT severity
# Convert product name standard name (MPS = Web MPS)
LOOKUP-product_for_fireeye = fireeye_product_lookup cef_dproduct OUTPUT product

FIELDALIAS-occurred_for_fireeye = rt as occurred
FIELDALIAS-category_for_fireeye = cef_name as category
FIELDALIAS-signature_for_fireeye = malfename as signature
FIELDALIAS-sig_name_for_fireeye = msg as sig_name
FIELDALIAS-file_hash_for_fireeye = fileHash as file_hash
FIELDALIAS-host_for_fireeye = dvc as host
FIELDALIAS-vendor_for_fireeye = cef_dvendor as vendor
FIELDALIAS-product_version_for_fireeye = cef_dversion as product_version
FIELDALIAS-ext_ref_for_fireeye = etpurl as ext_ref
FIELDALIAS-malware_url_for_fireeye = request AS malware_url
FIELDALIAS-subject_for_fireeye = emailsubj AS subject
FIELDALIAS-filename_for_fireeye = malname AS file_name
EXTRACT-id = .*?etpurl\=.*?\/(?P<id>\d+)\/\s


###### FireEye JSON from TAP ######
[fe_tap_json]
#SHOULD_LINEMERGE=false
#LINE_BREAKER=\{\s*([\r\n]+)\s*"updateDate":.*[\r\n]+\s+"_createdBy":
FIELDALIAS-id_for_fireeye = displayId AS id
FIELDALIAS-offset_for_fireeye = displayId AS offset
FIELDALIAS-signature_for_fireeye = message AS signature
FIELDALIAS-source_ip_for_fireeye = distinguishers.srcipv4 AS src_ip
#risk=risk
#confidence=confidence
#createDate=createDate
#eventCount=eventCount
#state=state
#description=description
#
