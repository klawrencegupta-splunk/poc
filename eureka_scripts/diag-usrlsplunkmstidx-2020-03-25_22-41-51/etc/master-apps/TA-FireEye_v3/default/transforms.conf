# For questions or issues email:  Tony.Lee -at- FireEye.com

#Clean fe_xml_syslog
#throw away the beginning XML tag
#[xmlbeginNULL]
#REGEX = ^(.*?\<\?xml version\=.*?\>)
#REGEX = ^(\<\?xml version\=)
#REGEX=^(\<164\>)
#DEST_KEY = queue
#FORMAT = nullQueue

# For KV Store ticketing
[acknotes]
external_type = kvstore
collection = acknotescoll
fields_list = _key, Product, id, Ack, Notes

# Required to rename sourcetype=syslog to sourcetype=hx_cef_syslog
[fix_HX_CEF_st]
REGEX=.*:\sCEF\:\d\|mandiant\|mso\|
DEST_KEY=MetaData:Sourcetype
FORMAT=sourcetype::hx_cef_syslog

# Required to send hx_cef_syslog to index=fe
[fix_HX_CEF_in]
REGEX=.*:\sCEF\:\d\|mandiant\|mso\|
DEST_KEY=_MetaData:Index
FORMAT=fireeye

# Required to rename sourcetype=syslog to sourcetype=hx_cef_syslog
[fix_HX2_CEF_st]
REGEX=.*:\sCEF\:\d\|fireeye\|hx\|
DEST_KEY=MetaData:Sourcetype
FORMAT=sourcetype::hx_cef_syslog

# Required to send hx2_cef_syslog to index=fe
[fix_HX2_CEF_in]
REGEX=.*:\sCEF\:\d\|fireeye\|hx\|
DEST_KEY=_MetaData:Index
FORMAT=fireeye

# Required to rename sourcetype=syslog to sourcetype=fe_cef_syslog
[fix_FireEye_CEF_st]
REGEX=.*fenotify.*\:\sCEF\:\d\|FireEye\|
DEST_KEY=MetaData:Sourcetype
FORMAT=sourcetype::fe_cef_syslog

# Required to send fe_cef_syslog to index=fireeye
[fix_FireEye_CEF_in]
REGEX=.*fenotify.*\:\sCEF\:\d\|FireEye\|
DEST_KEY=_MetaData:Index
FORMAT=fireeye

# Required to rename sourcetype=syslog to sourcetype=fe_csv_syslog
[fix_FireEye_CSV_st]
REGEX=.*fenotify.*\:\sCSV\:\d\:FireEye\:
DEST_KEY=MetaData:Sourcetype
FORMAT=sourcetype::fe_csv_syslog

# Required to send fe_csv_syslog to index=fireeye
[fix_FireEye_CSV_in]
REGEX=.*fenotify.*\:\sCSV\:\d\:FireEye\:
DEST_KEY=_MetaData:Index
FORMAT=fireeye

# Required to rename (TCP and UDP) sourcetype=syslog to sourcetype=fe_xml_syslog
[fix_FireEye_XML_st]
REGEX=.*fenotify.*\:\s\<\?xml
DEST_KEY=MetaData:Sourcetype
FORMAT=sourcetype::fe_xml_syslog

# Required to send fe_xml to index=fireeye
[fix_FireEye_XML_in]
REGEX=.*fenotify.*\:\s\<\?xml
DEST_KEY=_MetaData:Index
FORMAT=fireeye

# Required to rename (TCP and UDP) sourcetype=syslog to sourcetype=fe_json_syslog
[fix_FireEye_JSON_st]
REGEX=.*fenotify.*\:\s\{
DEST_KEY=MetaData:Sourcetype
FORMAT=sourcetype::fe_json_syslog

#[vtLookup]
#external_cmd = wrapper.py file_hash vt
#fields_list = file_hash, vt

#Strip syslog header from JSON
[FEYE-syslog-header-strip]
LOOKAHEAD     = 1000000
REGEX         = (?s).*?fenotify.*?({.*})
#REGEX         = ^\<[0-9]{1,5}>fenotify.*?(?<foo>{.*}$)
FORMAT        = $1
DEST_KEY      = _raw

#Strip syslog header from XML
[FEYE-syslog-header-strip-xml]
REGEX         = (?s).*?fenotify.*?(?<foo>\<\?xml\sversion.*?\<\/alerts\>)
FORMAT        = $1
DEST_KEY      = _raw


# Required for CEF severity to be translated from number to word (ex: 1 = minr)
[fireeye_severity_lookup]
filename = fireeye_severity.csv

# Required for CEF severity to be translated from number to word (ex: 1 = minr)
[hx_fireeye_severity_lookup]
filename = hx_fireeye_severity.csv

# Required for CEF product name to be translated from non-standard to standard name (ex: MPS = "Web MPS")
[fireeye_product_lookup]
filename = CEF_product_names.csv

# Required to parse CEF header (6 fields at a time)
#[hx_cef]
#REGEX=CEF\:\d\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|
#FORMAT=cef_dvendor::$1 cef_dproduct::$2 cef_dversion::$3 cef_sid::$4 cef_name::$5 cef_severity::$6

# Required to parse CEF header (6 fields at a time)
[fireeye_cef]
REGEX=CEF\:\d\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|([^\|]+)\|
FORMAT=cef_dvendor::$1 cef_dproduct::$2 cef_dversion::$3 cef_sid::$4 cef_name::$5 cef_severity::$6

# Required to properly parse CEF keys that have spaces
[cefKeys]
REGEX = (?:_+)?(?<_KEY_1>[\w.:\[\]]+)=(?<_VAL_1>.*?(?=(?:\s[\w.:\[\]]+=|$)))
REPEAT_MATCH = True
CLEAN_KEYS = 1

###### FireEye JSON via Syslog ######
[dst_as_dest]
REGEX = dst\=([^\s]+)
FORMAT = dest::$1

[dst_ip_as_dest]
REGEX = dst_ip\=([^\s]+)
FORMAT = dest::$1

[dest_ip_as_dest]
SOURCE_KEY = dest_ip
REGEX = (.+)
FORMAT = dest::$1

[dest_host_as_dest]
SOURCE_KEY = dest_host
REGEX = (.+)
FORMAT = dest::$1

[dmac_as_dest]
REGEX = dmac\=([^\s]+)
FORMAT = dest::$1

[dest_mac_as_dest]
SOURCE_KEY = dest_mac
REGEX = (.+)
FORMAT = dest::$1

[src_as_src]
REGEX = src\=([^\s]+)
FORMAT = src::$1

[src_ip_re_as_src]
REGEX = src_ip\=([^\s]+)
FORMAT = src::$1

[src_ip_as_src]
SOURCE_KEY = src_ip
REGEX = (.+)
FORMAT = src::$1

[src_host_as_src]
SOURCE_KEY = src_host
REGEX = (.+)
FORMAT = src::$1

[smac_as_src]
REGEX = smac\=([^\s]+)
FORMAT = src::$1

[src_mac_as_src]
SOURCE_KEY = src_mac
REGEX = (.+)
FORMAT = src::$1
